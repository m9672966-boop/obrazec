<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–£—á—ë—Ç –æ–±—Ä–∞–∑—Ü–æ–≤</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
    h1 { text-align: center; margin-bottom: 20px; }
    .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    input, select, button { padding: 8px; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #f8f9fa; }
    .actions { display: flex; gap: 5px; }
    .btn { padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; }
    .btn-edit { background: #3498db; color: white; }
    .btn-delete { background: #e74c3c; color: white; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>–£—á—ë—Ç –≥–æ—Ç–æ–≤—ã—Ö –æ–±—Ä–∞–∑—Ü–æ–≤</h1>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters">
      <input type="date" id="startDate" placeholder="–° –¥–∞—Ç—ã">
      <input type="date" id="endDate" placeholder="–ü–æ –¥–∞—Ç—É">
      <button onclick="loadSamples()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      <a id="exportLink" class="btn" style="text-decoration: none; background: #27ae60; color: white; padding: 8px 16px; border-radius: 4px;" href="#">üì• –°–∫–∞—á–∞—Ç—å Excel</a>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="form-grid" id="addForm">
      <input type="text" id="article" placeholder="–ê—Ä—Ç–∏–∫—É–ª">
      <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
      <input type="text" id="brand" placeholder="–¢–æ—Ä–≥–æ–≤–∞—è –º–∞—Ä–∫–∞">
      <select id="category">
        <option value="–õ–µ–æ–Ω–∞—Ä–¥–æ">–õ–µ–æ–Ω–∞—Ä–¥–æ</option>
        <option value="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º</option>
        <option value="–£—Ç–∏–ª—å">–£—Ç–∏–ª—å</option>
      </select>
      <input type="text" id="condition" placeholder="–°–æ—Å—Ç–æ—è–Ω–∏–µ">
      <input type="text" id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
      <input type="text" id="photo" placeholder="–§–æ—Ç–æ (—Å—Å—ã–ª–∫–∞)">
      <input type="text" id="responsible" placeholder="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π">
      <input type="date" id="date">
      <button onclick="addSample()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div id="tableContainer"></div>
  </div>

  <script>
    let editingId = null;

    function formatDate(dateStr) {
      return dateStr ? dateStr.split('T')[0] : '';
    }

    function loadSamples() {
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      const url = `/api/samples?startDate=${start}&endDate=${end}`;
      fetch(url)
        .then(r => r.json())
        .then(samples => {
          let html = `<table><thead><tr>
            <th>–ê—Ä—Ç–∏–∫—É–ª</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¢–ú</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th>–§–æ—Ç–æ</th><th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th><th>–î–∞—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr></thead><tbody>`;
          samples.forEach(s => {
            html += `<tr>
              <td>${s.article || ''}</td>
              <td>${s.name || ''}</td>
              <td>${s.brand || ''}</td>
              <td>${s.category || ''}</td>
              <td>${s.condition || ''}</td>
              <td>${s.comment || ''}</td>
              <td>${s.photo || ''}</td>
              <td>${s.responsible || ''}</td>
              <td>${formatDate(s.date)}</td>
              <td class="actions">
                <button class="btn btn-edit" onclick="editSample(${s.id})">‚úèÔ∏è</button>
                <button class="btn btn-delete" onclick="deleteSample(${s.id})">üóëÔ∏è</button>
              </td>
            </tr>`;
          });
          html += '</tbody></table>';
          document.getElementById('tableContainer').innerHTML = html;

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É —ç–∫—Å–ø–æ—Ä—Ç–∞
          const exportUrl = `/api/export-excel?startDate=${start}&endDate=${end}`;
          document.getElementById('exportLink').href = exportUrl;
        });
    }

    function addSample() {
      const data = {
        article: document.getElementById('article').value,
        name: document.getElementById('name').value,
        brand: document.getElementById('brand').value,
        category: document.getElementById('category').value,
        condition: document.getElementById('condition').value,
        comment: document.getElementById('comment').value,
        photo: document.getElementById('photo').value,
        responsible: document.getElementById('responsible').value,
        date: document.getElementById('date').value
      };
      fetch('/api/samples', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
        .then(() => {
          loadSamples();
          document.querySelectorAll('#addForm input, #addForm select').forEach(el => el.value = '');
        });
    }

    function editSample(id) {
      if (editingId === id) return;
      editingId = id;
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ inline –∏–ª–∏ –≤ –º–æ–¥–∞–ª–∫–µ
      alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ ID=' + id + ' –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –î–ª—è MVP –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ + –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ.');
    }

    function deleteSample(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
      fetch(`/api/samples/${id}`, { method: 'DELETE' })
        .then(() => loadSamples());
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadSamples();
  </script>
</body>
</html>
